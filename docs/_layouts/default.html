<!DOCTYPE html>
<html lang="{{ page.lang | default: site.default_lang | default: 'en' }}">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% if page.title %}{{ page.title | escape }} - {% endif %}{{ site.title | escape }}</title>
  <meta name="description" content="{{ page.description | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
  
  <!-- Fonts and styles -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="{{ '/assets/css/styles.css' | relative_url }}">
  
  <!-- Favicon -->
  <link rel="icon" href="{{ '/favicon.ico' | relative_url }}">
</head>

<body class="{% if page.layout %}{{ page.layout }}{% endif %} lang-{{ page.lang | default: 'en' }}">
  <!-- Skip to content link for accessibility -->
  <a class="skip-to-content" href="#main-content">{% if page.lang == 'it' %}Vai al contenuto{% else %}Skip to content{% endif %}</a>

  <div class="site-container">
    {% include header.html %}
    
    <div class="main-container">
      {% if page.layout == 'chapter' %}
      <aside class="sidebar">
        <div class="sidebar-inner">
          <h3>{% if page.lang == 'it' %}Capitoli{% else %}Chapters{% endif %}</h3>
          {% include chapter-list.html lang=page.lang %}
        </div>
      </aside>
      {% endif %}
      
      <main id="main-content" class="page-content">
        {{ content }}
      </main>
      
      <button id="ai-toggle" class="ai-toggle-button" aria-label="{% if page.lang == 'it' %}Mostra Assistente AI{% else %}Show AI Assistant{% endif %}">
        <i class="fas fa-robot"></i>
      </button>
      
      {% include ai-sidebar.html %}
    </div>
    
    {% include footer.html %}
  </div>
  
  {% include search.html %}
  
  <!-- Back to top button -->
  <button id="back-to-top" class="back-to-top" aria-label="Back to top">
    <i class="fas fa-arrow-up"></i>
  </button>
  
  <script src="{{ '/assets/js/main.js' | relative_url }}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // AI Sidebar toggle
      const aiToggleBtn = document.getElementById('ai-toggle');
      const aiSidebar = document.querySelector('.ai-sidebar');
      
      if (aiToggleBtn && aiSidebar) {
        aiToggleBtn.addEventListener('click', function() {
          aiSidebar.classList.toggle('active');
          this.classList.toggle('active');
        });
      }
      
      // Back to top button
      const backToTopBtn = document.getElementById('back-to-top');
      
      if (backToTopBtn) {
        window.addEventListener('scroll', function() {
          if (window.scrollY > 300) {
            backToTopBtn.classList.add('visible');
          } else {
            backToTopBtn.classList.remove('visible');
          }
        });
        
        backToTopBtn.addEventListener('click', function() {
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        });
      }
    });
  </script>
</body>
</html>
