<!-- AI Sidebar Component -->
<div class="ai-sidebar">
  <div class="ai-sidebar-header">
    <h3>{% if page.lang == 'it' %}Assistente AI{% else %}AI Assistant{% endif %}</h3>
    <button class="ai-close" id="ai-close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  
  <div class="ai-sidebar-content">
    <div class="ai-intro">
      <div class="ai-avatar">
        <i class="fas fa-robot"></i>
      </div>
      
      {% if page.lang == 'it' %}
        <p>Ciao! Sono l'assistente AI di Peeragogy. Come posso aiutarti a comprendere meglio i concetti di apprendimento tra pari?</p>
      {% else %}
        <p>Hello! I'm the Peeragogy AI assistant. How can I help you better understand peer learning concepts?</p>
      {% endif %}
    </div>
    
    <div class="ai-chat">
      <div class="ai-messages" id="ai-messages">
        <!-- Messages will appear here -->
      </div>
      
      <div class="ai-input">
        <textarea id="ai-user-input" 
                  placeholder="{% if page.lang == 'it' %}Fai una domanda...{% else %}Ask a question...{% endif %}"
                  rows="2"></textarea>
        <button id="ai-send" class="ai-send-btn">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
    
    <div class="ai-features">
      <button class="ai-feature-btn" id="ai-summarize">
        <i class="fas fa-file-alt"></i>
        <span>{% if page.lang == 'it' %}Riassumi capitolo{% else %}Summarize chapter{% endif %}</span>
      </button>
      <button class="ai-feature-btn" id="ai-explain">
        <i class="fas fa-lightbulb"></i>
        <span>{% if page.lang == 'it' %}Spiega concetto{% else %}Explain concept{% endif %}</span>
      </button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Toggle AI sidebar
    const aiToggleBtn = document.getElementById('ai-toggle');
    const aiSidebar = document.querySelector('.ai-sidebar');
    const aiCloseBtn = document.getElementById('ai-close');
    
    if (aiToggleBtn && aiSidebar) {
      aiToggleBtn.addEventListener('click', function() {
        aiSidebar.classList.toggle('active');
      });
    }
    
    if (aiCloseBtn && aiSidebar) {
      aiCloseBtn.addEventListener('click', function() {
        aiSidebar.classList.remove('active');
      });
    }
    
    // Send message function
    const sendBtn = document.getElementById('ai-send');
    const userInput = document.getElementById('ai-user-input');
    const messagesContainer = document.getElementById('ai-messages');
    
    if (sendBtn && userInput && messagesContainer) {
      sendBtn.addEventListener('click', function() {
        sendMessage();
      });
      
      userInput.addEventListener('keydown', function(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
          event.preventDefault();
          sendMessage();
        }
      });
      
      function sendMessage() {
        const userMessage = userInput.value.trim();
        
        if (!userMessage) return;
        
        // Add user message
        appendMessage('user', userMessage);
        
        // Clear input
        userInput.value = '';
        
        // Simulate AI response
        setTimeout(() => {
          const aiResponse = "Based on your question, I can explain that peeragogy (or paragogy) is about peer-to-peer learning and teaching. It recognizes that in a connected world, learners don't need traditional teachers but can learn effectively by collaborating with peers.";
          appendMessage('ai', aiResponse);
        }, 1000);
      }
      
      function appendMessage(sender, text) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}-message`;
        messageDiv.innerHTML = `<p>${text}</p>`;
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }
    }
    
    // Feature buttons
    const summarizeBtn = document.getElementById('ai-summarize');
    const explainBtn = document.getElementById('ai-explain');
    
    if (summarizeBtn && messagesContainer) {
      summarizeBtn.addEventListener('click', function() {
        appendMessage('user', '{% if page.lang == "it" %}Puoi riassumere questo capitolo?{% else %}Can you summarize this chapter?{% endif %}');
        
        setTimeout(() => {
          const summary = "{% if page.lang == 'it' %}Questo capitolo introduce i concetti fondamentali della peeragogia, spiegando come l'apprendimento tra pari possa essere più efficace del modello tradizionale insegnante-studente in molti contesti. Vengono presentati i pattern chiave e le pratiche per facilitare l'apprendimento collaborativo.{% else %}This chapter introduces the fundamental concepts of peeragogy, explaining how peer learning can be more effective than traditional teacher-student models in many contexts. It presents key patterns and practices for facilitating collaborative learning.{% endif %}";
          appendMessage('ai', summary);
        }, 1000);
      });
    }
    
    if (explainBtn && messagesContainer) {
      explainBtn.addEventListener('click', function() {
        appendMessage('user', '{% if page.lang == "it" %}Spiegami il concetto principale di questo capitolo{% else %}Explain the main concept of this chapter{% endif %}');
        
        setTimeout(() => {
          const explanation = "{% if page.lang == 'it' %}Il concetto principale è che l'apprendimento può essere organizzato e gestito dai pari stessi, senza necessità di un'autorità centrale o di un insegnante tradizionale. Questo approccio sfrutta l'intelligenza collettiva e le diverse prospettive del gruppo per creare un'esperienza di apprendimento più ricca e contestualizzata.{% else %}The main concept is that learning can be organized and managed by peers themselves, without the need for a central authority or traditional teacher. This approach leverages collective intelligence and diverse perspectives of the group to create a richer, more contextualized learning experience.{% endif %}";
          appendMessage('ai', explanation);
        }, 1000);
      });
    }
  });
</script>